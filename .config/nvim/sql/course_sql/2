CREATE TABLE roles (
	id SERIAL PRIMARY KEY,
  name VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE user_roles (
	user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  role_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  PRIMARY KEY (user_id, role_id)
);

CREATE TABLE profiles (
	user_id INTEGER PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE, 
  first_name VARCHAR(50) NOT NULL,
  last_name VARCHAR(50) NOT NULL,
  avatar_url TEXT,
  bio TEXT
);

CREATE TABLE contacts (
	id SERIAL PRIMARY KEY,
	user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(20) CHECK (type IN ('email', 'telegram', 'vk')),
  value TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

SELECT * FROM roles;

SELECT 
	u.username,
  r.name AS role
FROM users u
JOIN user_roles ur ON u.id = ur.user_id 
JOIN roles r ON r.id = ur.role_id;

